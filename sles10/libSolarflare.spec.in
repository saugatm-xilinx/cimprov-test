Name: %{PROVIDER_PACKAGE}
Version: %{PROVIDER_VERSION}.%{PROVIDER_REVISION}
Release:        %{RELEASE_TAG}
Summary: CIM provider for Solarflare NIC management

Group: Applications/System
License: GPL
URL: http://solarflare.com
Source0: %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

#BuildRequires:
#Requires:

%description

Prefix: %{PROVIDER_LIBPATH}
Prefix: %{PROVIDER_ROOT}/bin
Prefix: %{PROVIDER_ROOT}/mof

%prep
%setup -q


%build
make %{?_smp_mflags}
make %{?_smp_mflags} regmod

%install
rm -rf $RPM_BUILD_ROOT
make DESTDIR=$RPM_BUILD_ROOT install
make DESTDIR=$RPM_BUILD_ROOT install-aux

%post
%{PROVIDER_ROOT}/bin/regmod -n %{IMP_NAMESPACE} -c %{PROVIDER_LIBPATH}/%{PROVIDER_SO}
%{PROVIDER_ROOT}/bin/regmod -n %{INTEROP_NAMESPACE} -c %{PROVIDER_LIBPATH}/%{PROVIDER_SO} \
%{INTEROP_CLASSES}

%preun
%{PROVIDER_ROOT}/bin/regmod -n %{INTEROP_NAMESPACE} -u -c -i %{PROVIDER_LIBPATH}/%{PROVIDER_SO} \
%{INTEROP_CLASSES}
%{PROVIDER_ROOT}/bin/regmod -n %{IMP_NAMESPACE} -u -c -i %{PROVIDER_LIBPATH}/%{PROVIDER_SO}

%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
%attr(500,root,root) %{PROVIDER_ROOT}/bin/regmod
%{PROVIDER_LIBPATH}/%{PROVIDER_SO}
%attr(444,root,root) %{PROVIDER_ROOT}/mof/repository.mof
%doc

%changelog
