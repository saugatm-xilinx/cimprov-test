Name: %{PROVIDER_PACKAGE}
Version: %{PROVIDER_VERSION}.%{PROVIDER_REVISION}
Release:        %{RELEASE_TAG}
Summary: CIM provider for Solarflare NIC management

Group: Applications/System
License: GPL
URL: http://solarflare.com
Source0: %{PROVIDER_TARBALL}
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

%{BUILD_REQUIRES}
%{REQUIRES}

%description

Prefix: %{PROVIDER_LIBPATH}
Prefix: %{PROVIDER_ROOT}/mof

%prep
%setup -q -n %{PROVIDER_TARBALL_DIR}


%build
make CONFIG=%{CONFIG} %{?_smp_mflags}
make CONFIG=%{CONFIG} %{?_smp_mflags} registration

%install
rm -rf $RPM_BUILD_ROOT
make CONFIG=%{CONFIG} DESTDIR=$RPM_BUILD_ROOT install
make CONFIG=%{CONFIG} DESTDIR=$RPM_BUILD_ROOT install-aux

%post
%{PEGASUS_HOME}/bin/cimmof -n %{IMP_NAMESPACE} -uc -aE %{PROVIDER_ROOT}/mof/schema.mof
%{PEGASUS_HOME}/bin/cimmof -n %{IMP_NAMESPACE} -uc %{PROVIDER_ROOT}/mof/namespace.mof
%{PEGASUS_HOME}/bin/cimmof -n %{INTEROP_NAMESPACE} -uc %{PROVIDER_ROOT}/mof/interop.mof
%{PEGASUS_HOME}/bin/cimmof -n %{INTEROP_NAMESPACE} %{PROVIDER_ROOT}/mof/repository.reg


%preun
%{PEGASUS_HOME}/bin/cimprovider -r -m %{PROVIDER_LIBRARY}_Module

%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
%{PROVIDER_LIBPATH}/%{PROVIDER_SO}
%attr(444,root,root) %{PROVIDER_ROOT}/mof/namespace.mof
%attr(444,root,root) %{PROVIDER_ROOT}/mof/interop.mof
%attr(444,root,root) %{PROVIDER_ROOT}/mof/schema.mof
%attr(444,root,root) %{PROVIDER_ROOT}/mof/repository.reg
%doc

%changelog